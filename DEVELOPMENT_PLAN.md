# Unlimited-Shortcuts 開発計画

## 現状の問題点

### 1. 重複実装
- HTML5 Drag APIとマウスイベントベースの2つのドラッグシステムが同時に動作
- 同じイベントを両方が処理しようとして競合の可能性
- draggable="true"によりHTML5 Drag APIが自動的に有効化

### 2. 実装の詳細

#### HTML5 Drag API (shortcuts.js)
```javascript
// line 799-1061: setupDragAndDrop()
// line 1030-1061: attachItemEventListeners()
// line 455: item.draggable = true;
```

#### マウスイベント実装 (mouse-drag.js)
```javascript
// MouseDragManagerクラス全体
// より高度な視覚的フィードバック（クローン、プレースホルダー）
// ドラッグ閾値によるクリックとドラッグの区別
```

## 開発計画

### フェーズ1: 重複の解消 (優先度: 高)

1. **HTML5 Drag API実装の無効化**
   - shortcuts.js内のsetupDragAndDrop()の呼び出しを削除
   - draggable属性をfalseに設定
   - 不要なイベントリスナーの削除

2. **MouseDragManagerへの統一**
   - すべてのドラッグ&ドロップ操作をMouseDragManagerで処理
   - 既存の機能が正常に動作することを確認

### フェーズ2: 機能改善 (優先度: 中)

1. **エッジケースの処理**
   - 右端アイコンのドラッグ時の挙動改善
   - グリッドの最後の行での動作
   - 「ショートカットを追加」ボタンの位置調整

2. **視覚的フィードバックの改善**
   - ドロップゾーンの青い枠の表示タイミング
   - フォルダー作成モードとリオーダーモードの明確な区別
   - アニメーションの滑らかさ向上

3. **操作モードの明確化**
   - 中央エリア（40-60%）: フォルダー作成
   - 端エリア（0-40%, 60-100%）: リオーダー
   - フォルダーへのドロップ: 中央50%のみ

### フェーズ3: 最適化とテスト (優先度: 低)

1. **パフォーマンス最適化**
   - 不要な再描画の削減
   - イベントリスナーの最適化

2. **エラーハンドリング**
   - インデックス範囲外のエラー防止
   - 無効なドラッグ操作の処理

3. **テスト強化**
   - 各種ドラッグパターンのテスト
   - エッジケースのテスト

## 実装順序

1. ✅ 現状分析完了
2. ⏳ HTML5 Drag API実装の無効化
3. ⏳ MouseDragManagerの動作確認
4. ⏳ エッジケースの修正
5. ⏳ 視覚的フィードバックの改善
6. ⏳ テストとデバッグ

## 注意事項

- 変更は段階的に行い、各ステップで動作確認を実施
- エラーログシステムを活用してデバッグを効率化
- ユーザーの既存データに影響を与えないよう注意